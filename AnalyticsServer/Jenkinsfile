pipeline {
 agent any
stages {
 stage('Pull') {
     steps {
      sshagent(credentials : ['bdf590a9-941e-4146-bedc-4c815c8c5652']) {
            sh 'sudo ssh -o StrictHostKeyChecking=no root@147.182.240.158 uptime'
            sh 'sudo ssh -v root@147.182.240.158 "cd /home/AnalyticsServer/AnalyticsServer && git pull" '
               }
            }
                   }
 
  stage ('Stop') {
    steps{
        sshagent(credentials : ['bdf590a9-941e-4146-bedc-4c815c8c5652']) {
            sh 'sudo ssh -o StrictHostKeyChecking=no root@147.182.240.158 uptime'
            sh 'sudo ssh -v root@147.182.240.158 "systemctl stop analytics.service" '
               }
         }
                 }
  
   stage('Build') {
     steps {
      sshagent(credentials : ['bdf590a9-941e-4146-bedc-4c815c8c5652']) {
            sh 'sudo ssh -o StrictHostKeyChecking=no root@147.182.240.158 uptime'
            sh 'sudo ssh -v root@147.182.240.158 "cd /home/AnalyticsServer/AnalyticsServer && dotnet publish -c Release --output /var/www/analytics" '
               }
            }
                   }

 stage ('Run') {
    steps{
        sshagent(credentials : ['bdf590a9-941e-4146-bedc-4c815c8c5652']) {
            sh 'sudo ssh -o StrictHostKeyChecking=no root@147.182.240.158 uptime'
            sh 'sudo ssh -v root@147.182.240.158 "systemctl restart analytics.service" '
               }
         }
                 }
       }
}
